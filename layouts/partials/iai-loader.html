<div id="iai-loader" style="display: none;">
    <div class="glint"></div>
    <div class="slash-beam"></div>
    <div class="paper-half top"></div>
    <div class="paper-half bottom"></div>
    <div id="shrapnel-container"></div>
</div>

<style>
    :root {
        --iai-bg: #050505;
        --iai-fly-speed: 2.2s;
        --sakura-pink: #ff80bf;
        --sakura-glow: #ffb7c5;
    }

    #iai-loader {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 99999;
        perspective: 1500px;
        background: transparent;
        pointer-events: none;
    }

    /* 初始显示控制：通过 JS 动态切换 display */
    .iai-active-mode #iai-loader {
        display: block !important;
        visibility: visible;
    }

    .iai-done #iai-loader {
        visibility: hidden;
        transition: visibility 0s linear 2.5s;
    }

    .paper-half {
        position: absolute;
        width: 100%;
        height: 100%;
        background: var(--iai-bg);
        transition: transform var(--iai-fly-speed) cubic-bezier(0.2, 0.8, 0.2, 1), 
                    opacity var(--iai-fly-speed) ease;
        will-change: transform, opacity;
        pointer-events: auto;
    }

    .top {
        clip-path: polygon(0 0, 100% 0, 100% 62%, 90% 58%, 80% 61%, 70% 57%, 60% 60%, 50% 56%, 40% 59%, 30% 55%, 20% 58%, 10% 54%, 0 57%);
        transform-origin: left top;
    }

    .bottom {
        clip-path: polygon(0 57%, 10% 54%, 20% 58%, 30% 55%, 40% 59%, 50% 56%, 60% 60%, 70% 57%, 80% 61%, 90% 58%, 100% 62%, 100% 100%, 0 100%);
        transform-origin: right bottom;
    }

    .glint {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 6px;
        height: 6px;
        background: white;
        border-radius: 50%;
        transform: translate(-50%, -50%);
        box-shadow: 0 0 20px 5px white, 0 0 10px var(--sakura-pink);
        z-index: 100001;
        animation: iai-pulse 1s infinite alternate;
    }

    @keyframes iai-pulse {
        from { opacity: 0.5; transform: translate(-50%, -50%) scale(0.8); }
        to { opacity: 1; transform: translate(-50%, -50%) scale(1.3); }
    }

    .slash-beam {
        position: absolute;
        top: 50%;
        left: -50%;
        width: 200%;
        height: 8px;
        background: white;
        box-shadow: 0 0 20px 2px white, 0 0 40px 10px var(--sakura-pink), 0 0 60px 20px rgba(255, 128, 191, 0.4);
        transform: translateY(-50%) rotate(-15deg) scaleX(0);
        z-index: 100002;
        opacity: 0;
        filter: blur(0.5px);
    }

    .iai-active .glint { display: none; }
    
    .iai-active .slash-beam {
        animation: iai-strike 0.35s ease-out forwards;
    }

    @keyframes iai-strike {
        0% { transform: translateY(-50%) rotate(-15deg) scaleX(0); opacity: 1; }
        30% { transform: translateY(-50%) rotate(-15deg) scaleX(1); opacity: 1; }
        100% { transform: translateY(-50%) rotate(-15deg) scaleX(1.8); opacity: 0; }
    }

    .iai-active .paper-half.top {
        transform: translate3d(-15%, -110%, 400px) rotateX(25deg) rotateZ(-15deg) rotateY(-10deg);
        opacity: 0;
    }

    .iai-active .paper-half.bottom {
        transform: translate3d(15%, 110%, 400px) rotateX(-25deg) rotateZ(-15deg) rotateY(10deg);
        opacity: 0;
    }

    .shrapnel {
        position: absolute;
        background: #1a1a1a;
        width: 15px;
        height: 15px;
        top: 55%;
        left: 50%;
        opacity: 0;
        z-index: 99999;
    }

    .iai-active .shrapnel {
        animation: iai-explode 2s forwards 0.1s;
    }

    @keyframes iai-explode {
        0% { opacity: 1; transform: translate(0, 0) rotate(0deg); }
        100% { opacity: 0; transform: var(--tx) var(--ty) rotate(var(--tr)); }
    }
</style>

<script>
    (function() {
        // 使用 sessionStorage 记录是否已播放过动画
        const hasPlayed = sessionStorage.getItem('iai_played');

        if (!hasPlayed) {
            // 如果没播放过，进入“居合模式”
            document.documentElement.classList.add('iai-active-mode');

            document.addEventListener('DOMContentLoaded', function() {
                const container = document.getElementById('shrapnel-container');
                if (container) {
                    for(let i=0; i<16; i++) {
                        const s = document.createElement('div');
                        s.className = 'shrapnel';
                        s.style.setProperty('--tx', `translateX(${(Math.random()-0.5)*1200}px)`);
                        s.style.setProperty('--ty', `translateY(${(Math.random()-0.5)*1200}px)`);
                        s.style.setProperty('--tr', `${Math.random()*720}deg`);
                        s.style.width = Math.random()*30+10+'px';
                        s.style.height = Math.random()*10+4+'px';
                        s.style.clipPath = `polygon(${Math.random()*20}% 0%, 100% 0%, ${Math.random()*100}% 100%, 0% ${Math.random()*100}%)`;
                        container.appendChild(s);
                    }
                }
            });

            window.addEventListener('load', function() {
                setTimeout(function() {
                    document.documentElement.classList.add('iai-active');
                    // 标记已播放
                    sessionStorage.setItem('iai_played', 'true');
                    setTimeout(function() {
                        document.documentElement.classList.add('iai-done');
                        // 彻底移除样式，恢复正常滚动
                        document.documentElement.classList.remove('iai-active-mode');
                    }, 2500);
                }, 800);
            });
        } else {
            // 如果播放过，确保加载器彻底不显示
            document.getElementById('iai-loader').style.display = 'none';
        }
    })();
</script>